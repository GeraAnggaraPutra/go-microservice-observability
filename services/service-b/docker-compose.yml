services:
  api:
    container_name: service-b-api
    build:
      context: .
      dockerfile: Dockerfile
    image: service-b-api:latest
    env_file:
      - .env
    volumes:
      - ./.env:/app/.env
    ports:
      - "${APP_PORT}:${APP_PORT}"
    networks:
      - app-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${APP_PORT}/health"]
      interval: 30s
      timeout: 10s
      retries: 5

  alloy:
    container_name: service-b-alloy
    image: grafana/alloy:v1.4.0
    command:
      - run
      - /etc/alloy/config.hcl
    volumes:
      - ./config/alloy.hcl:/etc/alloy/config.hcl
      - /var/run/docker.sock:/var/run/docker.sock:ro
    depends_on:
      - api
    networks:
      - app-network
      - monitoring-network

networks:
  app-network:
    driver: bridge

  monitoring-network:
    external: true
